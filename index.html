<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>YogaSix West New York — Live Schedule</title>
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@400;600;700&display=swap" rel="stylesheet">

  <style>
    :root{
      --bg1:#8ed1e6; --bg2:#c1b6f8; --panel:#edf3f7; --panel-border:#dde7ee;
      --chip:#f6fbff; --ink:#1c2a37; --ink-dim:#4f6b7c; --accent:#49c6e5;
      --accent-2:#9a8cff; --glow: 0 10px 30px rgba(34,49,63,.15);
      --radius: 16px; --radius-lg: 20px;
    }

    /* Background: gradient + subtle yoga icons (data-URI SVG) */
    body{
      margin:0; font-family: "Outfit", system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial, sans-serif;
      color:var(--ink); background: radial-gradient(1200px 600px at 20% 0%, var(--bg1) 0%, transparent 60%),
                          radial-gradient(1200px 600px at 80% 0%, var(--bg2) 0%, transparent 60%), #a7c7f2;
      min-height:100dvh;
      /* yoga motif (lotus + mat + chakra) */
      --svg: url("data:image/svg+xml;utf8,\
        <svg xmlns='http://www.w3.org/2000/svg' width='220' height='220' viewBox='0 0 220 220'>\
          <g fill='none' stroke='white' stroke-opacity='.12' stroke-width='2'>\
            <!-- lotus -->\
            <path d='M110 58c-8 10-28 18-28 35 0 17 15 31 28 31s28-14 28-31c0-17-20-25-28-35z'/>\
            <!-- rolled mat -->\
            <path d='M40 150h90a12 12 0 0 1 0 24H64a12 12 0 0 1 0-24'/>\
            <!-- chakra circles -->\
            <circle cx='178' cy='162' r='22' />\
            <circle cx='178' cy='162' r='10' />\
          </g>\
        </svg>");
      background-image:
        radial-gradient(1000px 800px at 50% 0%, rgba(255,255,255,.20) 0%, rgba(255,255,255,0) 60%),
        var(--svg);
      background-size: auto, 220px 220px;
      background-position: center top, center;
      background-attachment: fixed, fixed;
    }

    .wrap{ max-width:1180px; margin:32px auto 80px; padding:0 16px; }
    .hero{ text-align:center; padding-top:20px; }
    .title{ font-weight:700; font-size:clamp(28px, 5vw, 52px); letter-spacing:.5px; margin:0 0 4px; color:#fff; text-shadow:0 4px 24px rgba(0,0,0,.18); }
    .subtitle{ color:#f7fbff; opacity:.9; font-weight:600; letter-spacing:.2px; }

    .cta-row{ display:flex; flex-wrap:wrap; justify-content:center; gap:14px; margin:18px 0 28px; }
    .cta{
      display:inline-flex; align-items:center; gap:10px; font-weight:600; padding:12px 18px; border-radius:999px;
      background: linear-gradient(90deg, rgba(73,198,229,.16), rgba(154,140,255,.18));
      color:#fff; text-decoration:none; backdrop-filter:saturate(120%) blur(6px);
      box-shadow: var(--glow); border:1px solid rgba(255,255,255,.25);
    }
    .cta:hover{ transform:translateY(-1px); transition:transform .15s ease; }

    .card{
      background: var(--panel); border:1px solid var(--panel-border); border-radius: var(--radius-lg);
      box-shadow: var(--glow);
    }
    .section{ margin-top:18px; }
    .section-head{
      display:flex; align-items:center; justify-content:space-between;
      padding:16px 18px; border-bottom:1px dashed #d9e6ef; color:var(--ink-dim); font-weight:700;
    }
    .section-sub{ font-weight:600; color:var(--ink-dim); }
    .list{ padding:8px; }
    .row{
      display:flex; gap:18px; align-items:center; padding:16px;
      border-radius:var(--radius); background:var(--chip); margin:10px; border:1px solid #e9f0f6;
    }
    .time{ font-weight:700; background:#fff; border:1px solid #e6eef5; border-radius:999px; padding:10px 14px; min-width:84px; text-align:center; }
    .info{ display:flex; gap:8px; align-items:baseline; flex-wrap:wrap; }
    .titleTxt{ font-weight:700; }
    .sep{ opacity:.55; }
    .teacher{ font-weight:400; color:var(--ink-dim); }

    .week{
      display:grid; gap:16px; padding:16px;
      grid-template-columns: repeat(3, 1fr);
    }
    @media (max-width: 900px){ .week{ grid-template-columns: repeat(2, 1fr); } }
    @media (max-width: 620px){ .week{ grid-template-columns: 1fr; } }

    .day-card{ background:var(--panel); border:1px solid var(--panel-border); border-radius:var(--radius-lg); overflow:hidden; box-shadow: var(--glow); }
    .day-head{ font-weight:700; color:var(--ink-dim); padding:14px 16px; border-bottom:1px dashed #d9e6ef; display:flex; gap:8px; align-items:baseline; }
    .day-head .date{ font-weight:600; color:#6b87a0; }
    .empty{ padding:18px; color:#7a93a6; }
    .muted{ color:#7a93a6; font-weight:600; }
    .source{ font-size:12px; color:#7a93a6; }
  </style>
</head>

<body>
  <div class="wrap">
    <header class="hero">
      <h1 class="title">YogaSix West New York</h1>
      <div class="subtitle">Auto-updated from ClubReady</div>

      <div class="cta-row">
        <a class="cta" href="https://members.yogasix.com/offers/yogasix-west-new-york/3-classes-for-just-36?subtotal=false" target="_blank" rel="noopener">Book Intro Offer</a>
        <a class="cta" href="tel:+12013615299">Call (201) 361-5299</a>
        <a class="cta" href="https://maps.google.com/?q=YogaSix+West+New+York" target="_blank" rel="noopener">Get Directions</a>
      </div>
    </header>

    <!-- Today -->
    <section class="card section" id="todayCard">
      <div class="section-head">
        <div>Today’s Classes</div>
        <div class="source" id="todayDate"></div>
      </div>
      <div class="list" id="todayList">
        <!-- rows injected -->
      </div>
    </section>

    <!-- Week -->
    <section class="card section" id="weekCard">
      <div class="section-head">
        <div>This Week</div>
        <div class="section-sub">Sunday → Saturday</div>
      </div>
      <div class="week" id="weekGrid">
        <!-- day cards injected -->
      </div>
    </section>
  </div>

  <script><script>
  // ========= CONFIG =========
  const WORKER_BASE = "https://yogasix-schedule.kate-espinal.workers.dev";

  // Small helpers
  const $ = (sel, el=document) => el.querySelector(sel);
  const el = (tag, attrs={}) => Object.assign(document.createElement(tag), attrs);

  function datePretty(d=new Date()){
    return d.toLocaleDateString("en-US", { weekday:"long", month:"short", day:"numeric" });
  }
  function todayISO(){
    const d = new Date();
    const y=d.getFullYear(), m=String(d.getMonth()+1).padStart(2,'0'), day=String(d.getDate()).padStart(2,'0');
    return `${y}-${m}-${day}`;
  }
  function startOfWeekSundayISO(d=new Date()){
    const t = new Date(Date.UTC(d.getFullYear(), d.getMonth(), d.getDate()));
    const dow = t.getUTCDay();               // 0..6 where 0 = Sunday
    t.setUTCDate(t.getUTCDate() - dow);      // back to Sunday
    const y=t.getUTCFullYear(), m=String(t.getUTCMonth()+1).padStart(2,'0'), day=String(t.getUTCDate()).padStart(2,'0');
    return `${y}-${m}-${day}`;
  }

  async function fetchJSON(path){
    const r = await fetch(path, { headers: { "accept":"application/json" }});
    if(!r.ok) throw new Error(`Fetch failed ${r.status} for ${path}`);
    return r.json();
  }

  function rowNode({ time, title, teacher }){
    const row = el("div", { className:"row" });
    row.append(el("div", { className:"time", textContent: time || "" }));
    const info = el("div", { className:"info" });
    info.append(el("span", { className:"titleTxt", textContent: title || "" }));
    if (teacher){
      info.append(el("span", { className:"sep", textContent:"–" }));
      info.append(el("span", { className:"teacher", textContent: teacher }));
    }
    row.append(info);
    return row;
  }

  function dayCardNode({ label, date, items }){
    const card = el("div", { className:"day-card" });
    const head = el("div", { className:"day-head" });
    head.append(el("span", { textContent: label || "" }));
    if(date) head.append(el("span", { className:"date", textContent: date }));
    card.append(head);

    if(!items || items.length === 0){
      card.append(el("div", { className:"empty", textContent: "No classes" }));
    } else {
      const list = el("div", { className:"list" });
      items.forEach(item => list.append(rowNode(item)));
      card.append(list);
    }
    return card;
  }

  // Render Today (unchanged)
  async function renderToday(){
    $("#todayDate").textContent = datePretty(new Date());
    const data = await fetchJSON(`${WORKER_BASE}/daily.json?date=${todayISO()}`);
    const list = $("#todayList");
    list.innerHTML = "";
    const items = (data && data.items) || [];
    if(items.length === 0){
      list.append(el("div", { className:"empty", textContent:"No classes found today." }));
      return;
    }
    items.forEach(i => list.append(rowNode(i)));
  }

  // Render Week — only use weekly endpoint (no fallback to daily)
  async function renderWeek(){
    const start = startOfWeekSundayISO(new Date());       // required by your worker
    const payload = await fetchJSON(`${WORKER_BASE}/week.json?start=${start}`);

    // Accept either an array or { days: [...] } — but strictly from /week.json
    const days = Array.isArray(payload) ? payload : (Array.isArray(payload?.days) ? payload.days : []);
    const grid = $("#weekGrid");
    grid.innerHTML = "";

    // Always show Sunday → Saturday
    const labels = ["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"];

    // If worker doesn't guarantee order, place by index; otherwise, iterate and fill.
    const byIndex = new Array(7).fill(null);
    // Try to find a reliable index property; otherwise rely on natural order.
    days.forEach((d, idx) => {
      // Prefer provided index/dow when present
      const i = Number.isInteger(d.index) ? d.index
              : Number.isInteger(d.dow)   ? d.dow
              : idx % 7;
      byIndex[i] = d;
    });

    for (let i=0; i<7; i++){
      const d = byIndex[i] || {};
      const items = d.items || [];
      const label = d.head || labels[i];
      const pretty = d.pretty || d.datePretty || d.date || "";
      grid.append(dayCardNode({ label, date: pretty, items }));
    }
  }

  (async function init(){
    try { await renderToday(); }
    catch(e){
      $("#todayList").innerHTML = `<div class="empty">Could not load today’s classes.</div>`;
      console.error(e);
    }
    try { await renderWeek(); }
    catch(e){
      $("#weekGrid").innerHTML = `<div class="empty">Could not load weekly schedule.</div>`;
      console.error(e);
    }
  })();
</script>
</body>
</html>
