<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>YogaSix WNY • Live Class Schedule</title>
<meta name="theme-color" content="#67d5d2" />
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=Montserrat:wght@800&display=swap" rel="stylesheet">
<style>
  :root{
    --teal:#67d5d2; --lav:#b497e7;
    --text:#101827; --muted:#6b7280;
    --panel:rgba(255,255,255,.92); --pill:#f6f9fc;
    --radius:18px; --radius-lg:22px; --shadow:0 10px 28px rgba(31,41,55,.16);
  }
  *{box-sizing:border-box}
  html,body{margin:0;min-height:100%}
  body{
    font-family:Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
    color:var(--text);
    background:linear-gradient(135deg,var(--teal),var(--lav)) fixed;
    background-size:200% 200%;
    animation:bg 18s ease-in-out infinite alternate;
    overflow-x:hidden;
  }
  @keyframes bg{0%{background-position:0% 20%}100%{background-position:100% 80%}}

  .wrap{max-width:1100px;margin:36px auto 72px;padding:0 16px}
  header{color:#fff;text-align:center}
  header h1{margin:.25rem 0;font-family:Montserrat, Inter, sans-serif;font-weight:800;font-size:clamp(28px,5vw,46px);text-shadow:0 2px 14px rgba(0,0,0,.15)}
  header p{margin:.25rem 0 0;opacity:.95;font-weight:600}

  .actions{margin:16px auto 22px;display:flex;gap:10px;flex-wrap:wrap;justify-content:center}
  .btn{border:0;border-radius:999px;padding:10px 14px;font-weight:700;cursor:pointer;text-decoration:none;color:#fff;background:linear-gradient(135deg,var(--teal),var(--lav));box-shadow:0 6px 16px rgba(0,0,0,.12)}
  .btn:hover{transform:translateY(-1px)}

  .panel{background:var(--panel);backdrop-filter:blur(10px) saturate(140%);border:1px solid rgba(255,255,255,.6);border-radius:var(--radius-lg);box-shadow:var(--shadow);margin-top:18px}
  .panel .head{display:flex;align-items:center;gap:12px;padding:16px 18px}
  .head h2{font-size:18px;font-weight:800;margin:0}
  .head small{margin-left:auto;color:var(--muted);font-weight:600}
  .content{padding:0 16px 16px}

  .list{display:flex;flex-direction:column;gap:12px}
  .row{
    display:grid; grid-template-columns: 120px 1fr; gap:14px;
    background:var(--pill); border:1px solid rgba(15,23,42,.06);
    border-radius:var(--radius); padding:14px; align-items:center;
    box-shadow:inset 0 0 0 1px rgba(255,255,255,.5);
  }
  .time{
    font-weight:800; letter-spacing:.02em; color:#0b2742;
    background:#fff; border:1px solid rgba(15,23,42,.06); border-radius:999px; padding:10px 12px; text-align:center;
  }
  .titleLine{font-weight:700; font-size:1.02rem; color:#0a1424}
  .meta{color:var(--muted); font-size:.9rem; margin-top:2px}

  .weekGrid{display:grid; gap:16px; grid-template-columns:1fr}
  @media(min-width:820px){ .weekGrid{ grid-template-columns:1fr 1fr } }
  @media(min-width:1120px){ .weekGrid{ grid-template-columns:1fr 1fr 1fr } }

  .dayCard{background:var(--panel); border:1px solid rgba(15,23,42,.08); border-radius:20px; box-shadow:var(--shadow)}
  .dayHead{display:flex; align-items:baseline; gap:10px; padding:14px 16px 8px; border-bottom:1px dashed rgba(15,23,42,.08)}
  .dayName{font-weight:800}
  .dayDate{color:var(--muted); font-weight:700}
  .dayBody{padding:12px 16px 16px}
  .empty{padding:22px; text-align:center; color:#6b7a89}
</style>
</head>
<body>
  <div class="wrap">
    <header>
      <h1>Live Class Schedule</h1>
      <p>Auto-updated from ClubReady • Mobile-friendly</p>
    </header>

    <div class="actions">
      <a class="btn" href="https://members.yogasix.com/buy/yogasix-west-new-york" target="_blank" rel="noopener">Book Intro Offer</a>
      <a class="btn" href="tel:+12013615299">Call (201) 361-5299</a>
      <a class="btn" href="https://www.google.com/maps/dir/?api=1&destination=45+Riverwalk+Place,+West+New+York,+NJ+07020" target="_blank" rel="noopener">Get Directions</a>
    </div>

    <!-- Today -->
    <section class="panel" id="daily">
      <div class="head"><h2>Today</h2><small>Auto-updated</small></div>
      <div class="content"><div class="list" id="dailyList"><div class="empty">Loading…</div></div></div>
    </section>

    <!-- Full Week -->
    <section class="panel" id="weekly">
      <div class="head"><h2>This Week</h2><small>Sunday → Saturday</small></div>
      <div class="content"><div class="weekGrid" id="weekGrid"><div class="empty">Loading…</div></div></div>
    </section>
  </div>

<script>
const WORKER_BASE = "https://yogasix-schedule.kate-espinal.workers.dev";
const DAYS = ["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"];

const timePattern = "(?:1[0-2]|0?[1-9]):[0-5][0-9]\\s?(?:AM|PM)";
const chunkRe = new RegExp(`(${timePattern})([\\s\\S]*?)(?=${timePattern}|$)`, "gi");
const clean = s => (s||"").replace(/\u00A0/g," ").replace(/\s+/g," ").trim();
async function get(url){ try{ const r=await fetch(url,{cache:"no-store"}); if(!r.ok) throw 0; return await r.text(); } catch{ return null; } }

function parseText(text){
  const out=[]; let m;
  while((m = chunkRe.exec(text)) !== null){
    const time = clean(m[1]);
    const chunk = clean(m[2]);
    const parts = chunk.split(/(?:\r?\n)|·|\u2022| - |;|, /).map(clean).filter(Boolean).slice(0,8);

    let title="", instructor="", duration="";
    for(const p of parts){
      if(!title && !/(mins?|minute|hour)/i.test(p) && !/spaces?|occupied/i.test(p)) { title=p; continue; }
      if(!duration && /(mins?|minute|hour)/i.test(p)) { duration=p; continue; }
      if(!instructor && /^[A-Z][a-z]+(?:\s+[A-Z][a-z]+|\s*[A-Z]\.?)?$/.test(p)){ instructor=p; continue; }
    }
    out.push({time, title, instructor, duration});
  }
  return out;
}

function rowHTML(c){
  // Title — Instructor (both bold); no spots shown
  const line = [c.title, c.instructor].filter(Boolean).join(" — ");
  return `
    <div class="row">
      <div class="time">${c.time || ""}</div>
      <div>
        <div class="titleLine">${line}</div>
        ${c.duration ? `<div class="meta">${c.duration}</div>` : ""}
      </div>
    </div>
  `;
}

function renderDaily(list){
  const el = document.getElementById("dailyList");
  el.innerHTML = (list && list.length) ? list.map(rowHTML).join("") : '<div class="empty">No classes today.</div>';
}

function fmtISO(d){ const y=d.getFullYear(), m=String(d.getMonth()+1).padStart(2,"0"), day=String(d.getDate()).padStart(2,"0"); return `${y}-${m}-${day}`; }
function fmtUS(d){ const mm=String(d.getMonth()+1).padStart(2,"0"), dd=String(d.getDate()).padStart(2,"0"), y=d.getFullYear(); return `${mm}/${dd}/${y}`; }
function prettyDate(d){ return `${d.toLocaleString(undefined,{month:"short"})} ${d.getDate()}`; }

async function fetchDailyForDate(d){
  // Try multiple param styles in parallel. The Worker forwards all of them.
  const iso = fmtISO(d);
  const us  = fmtUS(d);
  const url = `${WORKER_BASE}/?which=daily&date=${encodeURIComponent(iso)}&Date=${encodeURIComponent(us)}&d=${encodeURIComponent(us)}&day=${encodeURIComponent(us)}&dayoffset=${Math.round((d - new Date())/86400000)}`;

  const html = await get(url);
  const text = clean(new DOMParser().parseFromString(html||"","text/html").body?.innerText || "");
  return parseText(text);
}

function dayCardHTML(dayName, d, rows){
  return `
    <div class="dayCard">
      <div class="dayHead">
        <div class="dayName">${dayName}</div>
        <div class="dayDate">${prettyDate(d)}</div>
      </div>
      <div class="dayBody">
        <div class="list">
          ${rows.length ? rows.map(rowHTML).join("") : `<div class="empty">No classes</div>`}
        </div>
      </div>
    </div>
  `;
}

(async function init(){
  // TODAY
  const todayHTML = await get(`${WORKER_BASE}/?which=daily`);
  const todayText = clean(new DOMParser().parseFromString(todayHTML||"","text/html").body?.innerText || "");
  const todayRows = parseText(todayText);
  renderDaily(todayRows);

  // WEEK: fetch 7 daily pages; avoid duplicates by comparing text signatures
  const start = new Date();
  const weekEl = document.getElementById("weekGrid");
  weekEl.innerHTML = "";

  const promises = Array.from({length:7}, async (_,i)=>{
    const d = new Date(start); d.setDate(start.getDate()+i);
    const rows = await fetchDailyForDate(d);
    return { d, rows };
  });

  const results = await Promise.all(promises);

  // De-duplicate accidental same-day responses (some tenants ignore date params)
  const seen = new Set();
  results.forEach(({d, rows})=>{
    const key = JSON.stringify(rows.map(r=>[r.time,r.title,r.instructor]));
    if(seen.has(key)) rows = []; else seen.add(key);
    const dayName = DAYS[d.getDay()];
    weekEl.insertAdjacentHTML("beforeend", dayCardHTML(dayName, d, rows));
  });
})();
</script>
</body>
</html>
